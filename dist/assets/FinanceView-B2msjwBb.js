import{o as l,c as d,a as e,t as f,g as w,p as D,q as X,s as he,h as Q,f as O,F as M,b as j,k as J,z as Y,i as S,v as ee,n as E,d as N,N as ae,w as ue,j as W,B as P,A as _e,C as me,u as re,e as se,T as we}from"./index-D3wbM7oO.js";import{A as q}from"./api-JDA1JVME.js";import{g as L}from"./auth-Buz3Qiex.js";import{_ as ce}from"./Button-1RoVZDeX.js";import{_ as $e}from"./Pagination-CtU1Q35g.js";const Ae={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},Ce={class:"grid grid-cols-2 gap-4"},Te=["value"],Fe=["value"],ge={__name:"DateFilter",props:{label:{type:String,required:!0},fromDate:{type:String,default:""},toDate:{type:String,default:""}},emits:["update:fromDate","update:toDate"],setup($,{emit:T}){const i=T,A=o=>{i("update:fromDate",o.target.value)},_=o=>{i("update:toDate",o.target.value)};return(o,y)=>(l(),d("div",null,[e("label",Ae,f($.label),1),e("div",Ce,[e("div",null,[y[0]||(y[0]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"From",-1)),e("input",{type:"date",value:$.fromDate,onInput:A,class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,Te)]),e("div",null,[y[1]||(y[1]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"To",-1)),e("input",{type:"date",value:$.toDate,onInput:_,class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,Fe)])])]))}},Ve={class:"relative"},ze={key:0,class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},De={class:"flex flex-wrap gap-1 p-2 min-h-[38px]"},Me=["onClick"],Ne={key:1,class:"text-gray-500 dark:text-gray-400"},Se={key:1,class:"absolute z-10 mt-1 w-full bg-white dark:bg-white-700 shadow-lg rounded-md py-1 text-base overflow-auto max-h-60"},Oe={key:0,class:"px-3 py-2"},Pe={class:"mt-1"},je=["onClick"],Be={key:0,class:"px-3 py-2 text-sm text-gray-500 dark:text-gray-400"},oe={__name:"MultiSelect",props:{modelValue:{type:Array,required:!0},options:{type:Array,required:!0},label:{type:String,default:""},searchable:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1}},emits:["update:modelValue"],setup($,{emit:T}){const i=$,A=T,_=w(!1),o=w(""),y=w(null),g=D(()=>{if(!o.value)return i.options;const a=o.value.toLowerCase();return i.options.filter(s=>s.name.toLowerCase().includes(a))}),b=a=>{const s=i.options.find(n=>n.id===a);return s?s.name:""},h=a=>i.modelValue.includes(a),C=a=>{let s;i.multiple?s=h(a)?i.modelValue.filter(n=>n!==a):[...i.modelValue,a]:(s=h(a)?[]:[a],_.value=!1),A("update:modelValue",s)},F=a=>{A("update:modelValue",i.modelValue.filter(s=>s!==a))},x=()=>{_.value=!_.value},r=a=>{y.value&&!y.value.contains(a.target)&&(_.value=!1)};return X(()=>{document.addEventListener("click",r)}),he(()=>{document.removeEventListener("click",r)}),Q(_,a=>{a||(o.value="")}),(a,s)=>(l(),d("div",Ve,[$.label?(l(),d("label",ze,f($.label),1)):O("",!0),e("div",{class:"relative min-w-[200px] border rounded-md shadow-sm cursor-pointer bg-white dark:bg-gray-700",onClick:x,ref_key:"selectRef",ref:y},[e("div",De,[$.modelValue.length?(l(!0),d(M,{key:0},j($.modelValue,n=>(l(),d("span",{key:n,class:"inline-flex items-center px-2 py-0.5 rounded text-sm bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},[J(f(b(n))+" ",1),e("button",{type:"button",class:"ml-1 inline-flex",onClick:Y(k=>F(n),["stop"])},s[2]||(s[2]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})],-1)]),8,Me)]))),128)):(l(),d("span",Ne," Tanlash... "))]),s[3]||(s[3]=e("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"})])],-1))],512),_.value?(l(),d("div",Se,[$.searchable?(l(),d("div",Oe,[S(e("input",{type:"text",class:"block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 dark:text-dark shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 dark:bg-white-700 dark:focus:ring-blue-500 sm:text-sm sm:leading-6",placeholder:"Search...","onUpdate:modelValue":s[0]||(s[0]=n=>o.value=n),onClick:s[1]||(s[1]=Y(()=>{},["stop"]))},null,512),[[ee,o.value]])])):O("",!0),e("div",Pe,[(l(!0),d(M,null,j(g.value,n=>(l(),d("button",{key:n.id,type:"button",class:E(["relative w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-white-600",{"bg-gray-50 dark:bg-white-600":h(n.id)}]),onClick:Y(k=>C(n.id),["stop"])},f(n.name),11,je))),128)),g.value.length?O("",!0):(l(),d("div",Be," No options found "))])])):O("",!0)]))}},Ue={class:"space-y-6"},qe={class:"space-y-4"},Ie={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Le={class:"flex items-center space-x-4 mb-4"},Ee={class:"flex-1"},Re={class:"inline-flex items-center"},He={class:"inline-flex items-center"},Ke={class:"inline-flex items-center"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"flex justify-end space-x-4 mt-4"},Ge={__name:"FinanceFilter",props:{filters:{type:Object,default:()=>({bankAccounts:[],kontragents:[],reasons:[]})}},emits:["filter"],setup($,{emit:T}){const i=$,A=T,_={search:"",types:[],bank_account_ids:[],kontragent_ids:[],reason_ids:[],created_at:{from:"",to:""},updated_at:{from:"",to:""}},o=w({..._}),y=D(()=>i.filters.bankAccounts.map(x=>({id:x.id,name:`${x.bank_name} (${x.currency})`}))),g=D(()=>i.filters.kontragents.map(x=>({id:x.id,name:x.name}))),b=D(()=>i.filters.reasons.map(x=>({id:x.id,name:x.name}))),h=(x,r)=>{if(x.includes(".")){const[a,s]=x.split(".");o.value[a][s]=r}else o.value[x]=r},C=()=>{const x={};Object.entries(o.value).forEach(([r,a])=>{if(Array.isArray(a)&&a.length>0)x[r]=a;else if(r==="search"&&a)x[r]=a;else if(typeof a=="object"&&a!==null){const s={};a.from&&(s.from=a.from),a.to&&(s.to=a.to),Object.keys(s).length>0&&(x[r]=s)}}),A("filter",x)},F=()=>{o.value={..._},A("filter",{})};return(x,r)=>(l(),d("div",Ue,[e("div",qe,[e("div",Ie,[N(oe,{modelValue:o.value.bank_account_ids,"onUpdate:modelValue":[r[0]||(r[0]=a=>o.value.bank_account_ids=a),r[1]||(r[1]=a=>h("bank_account_ids",a))],options:y.value,label:"Hisoblar",searchable:"",multiple:""},null,8,["modelValue","options"]),N(oe,{modelValue:o.value.kontragent_ids,"onUpdate:modelValue":[r[2]||(r[2]=a=>o.value.kontragent_ids=a),r[3]||(r[3]=a=>h("kontragent_ids",a))],options:g.value,label:"Kontragentlar",searchable:"",multiple:""},null,8,["modelValue","options"]),N(oe,{modelValue:o.value.reason_ids,"onUpdate:modelValue":[r[4]||(r[4]=a=>o.value.reason_ids=a),r[5]||(r[5]=a=>h("reason_ids",a))],options:b.value,label:"O'tkazma sababi",searchable:"",multiple:""},null,8,["modelValue","options"])]),e("div",Le,[e("div",Ee,[S(e("input",{type:"text","onUpdate:modelValue":r[6]||(r[6]=a=>o.value.search=a),onInput:r[7]||(r[7]=a=>h("search",a.target.value)),placeholder:"Izoh bo'yicha qidiruv...",class:"w-full rounded-md border-0 py-1.5 px-3 text-gray-900 dark:text-gray-300 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 dark:bg-gray-800 dark:focus:ring-blue-500 sm:text-sm sm:leading-6"},null,544),[[ee,o.value.search]])]),e("label",Re,[S(e("input",{type:"checkbox","onUpdate:modelValue":r[8]||(r[8]=a=>o.value.types=a),value:"in",class:"form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500 dark:border-gray-600 dark:focus:ring-blue-600 dark:ring-offset-gray-800"},null,512),[[ae,o.value.types]]),r[15]||(r[15]=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"Kirim",-1))]),e("label",He,[S(e("input",{type:"checkbox","onUpdate:modelValue":r[9]||(r[9]=a=>o.value.types=a),value:"out",class:"form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500 dark:border-gray-600 dark:focus:ring-blue-600 dark:ring-offset-gray-800"},null,512),[[ae,o.value.types]]),r[16]||(r[16]=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"Chiqim",-1))]),e("label",Ke,[S(e("input",{type:"checkbox","onUpdate:modelValue":r[10]||(r[10]=a=>o.value.types=a),value:"transfer",class:"form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500 dark:border-gray-600 dark:focus:ring-blue-600 dark:ring-offset-gray-800"},null,512),[[ae,o.value.types]]),r[17]||(r[17]=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"Transfer",-1))])]),e("div",Ye,[N(ge,{label:"Yaratilgan sana boyicha","from-date":o.value.created_at.from,"to-date":o.value.created_at.to,"onUpdate:fromDate":r[11]||(r[11]=a=>h("created_at.from",a)),"onUpdate:toDate":r[12]||(r[12]=a=>h("created_at.to",a))},null,8,["from-date","to-date"]),N(ge,{label:"Oxirgi o'zgartirilgan sana boyicha","from-date":o.value.updated_at.from,"to-date":o.value.updated_at.to,"onUpdate:fromDate":r[13]||(r[13]=a=>h("updated_at.from",a)),"onUpdate:toDate":r[14]||(r[14]=a=>h("updated_at.to",a))},null,8,["from-date","to-date"])]),e("div",Ze,[N(ce,{variant:"secondary",onClick:F},{default:ue(()=>r[18]||(r[18]=[J("Filterni tozalash")])),_:1}),N(ce,{onClick:C},{default:ue(()=>r[19]||(r[19]=[J("Filterni qo'shish")])),_:1})])])]))}},Qe={class:"overflow-x-auto"},Je={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},We={class:"bg-gray-50 dark:bg-gray-800"},Xe={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},et={key:0},tt=["colspan"],at={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},rt={class:"px-6 py-4 whitespace-pre text-sm text-gray-900 dark:text-white"},st={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},ot={class:"text-red-600 dark:text-red-400"},nt={class:"text-green-600 dark:text-green-400"},lt={class:"px-6 py-4 whitespace-nowrap text-sm"},it={key:0,class:"text-blue-600 dark:text-blue-400 font-medium"},dt={key:1,class:"text-gray-900 dark:text-white"},ut={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},ct={class:"px-6 py-4 text-sm text-gray-900 dark:text-white min-w-[200px]"},gt={class:"px-6 py-4 whitespace-pre text-sm text-gray-500 dark:text-gray-400"},mt={class:"px-6 py-4 whitespace-normal text-sm text-gray-900 dark:text-white"},pt={class:"text-red-600 dark:text-red-400"},ft={class:"text-green-600 dark:text-green-400"},yt={class:"mt-4"},bt={__name:"FinanceTable",props:{transactions:{type:Array,default:()=>[]},transfers:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({reasons:[],kontragents:[],bankAccounts:[],search:"",types:[]})},transactionMeta:{type:Object,default:()=>({})},transferMeta:{type:Object,default:()=>({})},currentPage:{type:Number,default:1},perPage:{type:Number,default:20}},emits:["page-change","per-page-change"],setup($,{emit:T}){const i=$,A=T,_=[{key:"id",label:"ID"},{key:"created_at",label:"Yaratilgan sana"},{key:"amount",label:"Summa"},{key:"reason_id",label:"O'tkazma sababi"},{key:"kontragent_id",label:"Kontragent"},{key:"description",label:"Izoh"},{key:"updated_at",label:"O'zgartirilgan sana"},{key:"bank_account_id",label:"Hisob"}],o=D(()=>{const t=i.filters.bankAccounts||[],u=i.filters.reasons||[],c=i.filters.kontragents||[],p=new Map;return t.forEach(v=>{p.set(Number(v.id),`${v.bank_name} (${v.currency})`)}),{reasons:new Map(u.map(v=>[Number(v.id),v.name])),kontragents:new Map(c.map(v=>[Number(v.id),v.name])),bankAccounts:p}}),y=t=>o.value.bankAccounts.get(Number(t))||"-",g=t=>o.value.reasons.get(Number(t))||"-",b=t=>o.value.kontragents.get(Number(t))||"-",h=new Intl.NumberFormat("ru-RU"),C=(t,u)=>{const c=parseFloat(t);return isNaN(c)?"-":`${h.format(c)} ${u}`},F=new Intl.DateTimeFormat("ru-RU"),x=new Intl.DateTimeFormat("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),r=t=>{if(!t)return"-";const[u,c]=t.split(" ");if(!u)return"-";const[p,v,V]=u.split("-"),B=c?`${V}-${v}-${p} ${c}`:`${V}-${v}-${p}`,I=new Date(B);return isNaN(I.getTime())?"-":`${F.format(I)}
${x.format(I)}`},a=D(()=>{const t=(i.transactionMeta.total||0)+(i.transferMeta.total||0),u=(i.transactionMeta.filtered_total||0)+(i.transferMeta.filtered_total||0),c=t!==u?i.transactions.length+i.transfers.length:Math.min(i.perPage,u-(i.currentPage-1)*i.perPage);return{current_page:i.currentPage,per_page:i.perPage,total:t,filtered_total:u,last_page:Math.max(i.transactionMeta.last_page||0,i.transferMeta.last_page||0),this_page:c}}),s=D(()=>i.transfers.map(t=>({id:t.id,display_id:`T-${t.id}`,created_at:r(t.created_at),updated_at:r(t.updated_at),amount:{from:C(t.from_amount,t.from_currency),to:C(t.to_amount,t.to_currency)},reason_id:"Hisoblar o'rtasidagi o'tkazma",kontragent_id:"-",description:t.description||"-",raw:t,isTransfer:!0}))),n=D(()=>{const t=o.value,u=i.transactions.map(p=>{const v=Number(p.bank_account_id);return{id:p.id,display_id:`TR-${p.id}`,created_at:r(p.created_at),updated_at:r(p.updated_at),type:p.type||"Transaction",amount:C(p.amount,p.currency),reason_id:g(p.reason_id),kontragent_id:b(p.kontragent_id),bank_account_id:t.bankAccounts.get(v)||"-",description:p.description||"-",raw:p,isTransfer:!1}}),c=s.value.map(p=>({id:`transfer-${p.id}`,display_id:p.display_id,created_at:p.created_at,updated_at:p.updated_at,type:"Transfer",amount:p.amount,reason_id:p.reason_id,kontragent_id:p.kontragent_id,bank_account_id:`${y(p.raw.from_account_id)} → ${y(p.raw.to_account_id)}`,description:p.description,raw:p.raw,isTransfer:!0}));return[...u,...c].sort((p,v)=>new Date(v.created_at)-new Date(p.created_at))}),k=D(()=>{var u;let t=[...n.value];return i.filters.search&&(t=t.filter(c=>{var p;return(p=c.description)==null?void 0:p.toLowerCase().includes(i.filters.search.toLowerCase())})),((u=i.filters.types)==null?void 0:u.length)>0&&(t=t.filter(c=>i.filters.types.includes(c.type))),t}),R=t=>{A("page-change",t)},m=t=>{A("per-page-change",t)};return(t,u)=>(l(),d("div",Qe,[e("table",Je,[e("thead",We,[e("tr",null,[(l(),d(M,null,j(_,c=>e("th",{key:c.key,scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},f(c.label),1)),64))])]),e("tbody",Xe,[k.value.length===0?(l(),d("tr",et,[e("td",{colspan:_.length,class:"px-6 py-4 text-center text-gray-500 dark:text-gray-400"}," No financial records found ",8,tt)])):O("",!0),(l(!0),d(M,null,j(k.value,c=>(l(),d("tr",{key:c.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[e("td",at,f(c.display_id),1),e("td",rt,f(c.created_at),1),e("td",st,[c.isTransfer?(l(),d(M,{key:0},[e("div",ot,f(c.amount.from),1),e("div",nt,f(c.amount.to),1)],64)):(l(),d("span",{key:1,class:E({"text-green-600 dark:text-green-400":c.type==="in","text-red-600 dark:text-red-400":c.type==="out"})},f(c.amount),3))]),e("td",lt,[c.isTransfer?(l(),d("span",it,f(c.reason_id),1)):(l(),d("span",dt,f(c.reason_id),1))]),e("td",ut,f(c.kontragent_id),1),e("td",ct,f(c.description),1),e("td",gt,f(c.updated_at),1),e("td",mt,[c.isTransfer?(l(),d(M,{key:0},[e("div",pt,f(y(c.raw.from_account_id)),1),e("div",ft,f(y(c.raw.to_account_id)),1)],64)):(l(),d(M,{key:1},[J(f(y(c.raw.bank_account_id)),1)],64))])]))),128))])]),e("div",yt,[N($e,{meta:a.value,onPageChange:R,onPerPageChange:m},null,8,["meta"])])]))}},xt={class:"flex-shrink-0 flex justify-between items-center px-4 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-700"},kt={class:"text-xl font-semibold text-gray-900 dark:text-white"},vt={class:"p-4 sm:p-6 space-y-4 sm:space-y-6"},ht=["value"],_t=["value"],wt=["value"],$t={class:"flex-shrink-0 px-4 sm:px-6 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700"},At={class:"flex justify-end space-x-3"},Ct=["disabled"],Tt={key:0},Ft={key:1},Vt={__name:"TransactionForm",props:{show:{type:Boolean,default:!1},type:{type:String,default:"in"}},emits:["close","transaction-created"],setup($,{emit:T}){const i=$,A=T,_=w(!1),o=w([]),y=w([]),g=w({amount:"",bank_account_id:"",reason_id:"",description:""}),b=s=>s?s.toString().replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," "):"",h=s=>s?s.toString().replace(/\s/g,""):"",C=async()=>{try{const s=await P.get(`${q}/bankAccount/get`,{headers:await L()});o.value=Array.isArray(s.data)?s.data:s.data.data||[]}catch(s){console.error("Error fetching bank accounts:",s)}},F=w(null),x=async()=>{try{const s=await P.get(`${q}/user`,{headers:await L()});F.value=s.data}catch(s){console.error("Error fetching user:",s)}},r=async()=>{var s;try{const n=await P.get(`${q}/reasons/${i.type}`,{headers:await L(),params:{group_id:((s=F.value)==null?void 0:s.type)==="storekeeper"?49:void 0}});y.value=n.data.data||[]}catch(n){console.error("Error fetching reasons:",n)}};Q(()=>i.type,()=>{r(),g.value.reason_id=""});const a=async()=>{if(!_.value)try{_.value=!0;const s=await P.post(`${q}/transactions/transaction/${i.type}/create`,{...g.value,amount:h(g.value.amount),type:i.type},{headers:await L()});A("transaction-created",s.data),A("close"),g.value={amount:"",bank_account_id:"",reason_id:"",description:""}}catch(s){console.error("Error creating transaction:",s)}finally{_.value=!1}};return X(()=>{C(),x().then(()=>r())}),(s,n)=>(l(),d("div",null,[e("div",{class:E(["fixed inset-0 bg-black bg-opacity-50 transition-opacity",{"opacity-100":$.show,"opacity-0":!$.show}]),onClick:n[0]||(n[0]=k=>s.$emit("close"))},null,2),e("div",{class:E(["fixed inset-y-0 right-0 w-full sm:w-[480px] bg-white dark:bg-gray-800 shadow-lg transform transition-transform duration-300 z-50 flex flex-col",{"translate-x-0":$.show,"translate-x-full":!$.show}])},[e("div",xt,[e("h2",kt,f($.type==="in"?"Kirim":"Chiqim"),1),e("button",{onClick:n[1]||(n[1]=k=>s.$emit("close")),class:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},n[7]||(n[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("form",{onSubmit:Y(a,["prevent"]),class:"flex-1 overflow-y-auto"},[e("div",vt,[e("div",null,[n[9]||(n[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Hisoblar",-1)),S(e("select",{"onUpdate:modelValue":n[2]||(n[2]=k=>g.value.bank_account_id=k),required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},[n[8]||(n[8]=e("option",{value:""},"Hisobni tanlang",-1)),(l(!0),d(M,null,j(o.value,k=>(l(),d("option",{key:k.id,value:k.id},f(k.bank_name)+" ("+f(new Intl.NumberFormat("uz-UZ").format(k.balance))+" "+f(k.currency)+") ",9,ht))),128))],512),[[W,g.value.bank_account_id]])]),e("div",null,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Summa",-1)),e("input",{value:b(g.value.amount),onInput:n[3]||(n[3]=k=>g.value.amount=k.target.value),type:"text",pattern:"[\\d\\s]*",inputmode:"numeric",required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base",placeholder:"Enter amount"},null,40,_t)]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"O'tkazma sababi",-1)),S(e("select",{"onUpdate:modelValue":n[4]||(n[4]=k=>g.value.reason_id=k),required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},[n[11]||(n[11]=e("option",{value:""},"O'tkazma sababini tanlang",-1)),(l(!0),d(M,null,j(y.value,k=>(l(),d("option",{key:k.id,value:k.id},f(k.name),9,wt))),128))],512),[[W,g.value.reason_id]])]),e("div",null,[n[13]||(n[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Izoh",-1)),S(e("textarea",{"onUpdate:modelValue":n[5]||(n[5]=k=>g.value.description=k),rows:"3",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm resize-none text-sm sm:text-base",placeholder:"Izohni kiriting"},null,512),[[ee,g.value.description]])])]),e("div",$t,[e("div",At,[e("button",{type:"button",onClick:n[6]||(n[6]=k=>s.$emit("close")),class:"inline-flex justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600"}," Bekor qilish "),e("button",{type:"submit",disabled:_.value,class:"inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600"},[_.value?(l(),d("span",Tt,"Yaratilyapti...")):(l(),d("span",Ft,"Yaratish"))],8,Ct)])])],32)],2)]))}},zt={class:"fixed inset-y-0 right-0 w-full sm:w-[480px] bg-white dark:bg-gray-800 shadow-lg transform z-50 flex flex-col"},Dt={class:"flex-shrink-0 flex justify-between items-center px-4 sm:px-6 py-4 border-b border-gray-200 dark:border-gray-700"},Mt={class:"p-4 sm:p-6 space-y-4 sm:space-y-6"},Nt={class:"flex space-x-4"},St={class:"flex-1"},Ot=["value"],Pt={class:"flex-1"},jt=["value"],Bt={key:0,class:"space-y-2"},Ut={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},qt=["value"],It={key:1,class:"space-y-4"},Lt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},Et=["value"],Rt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},Ht=["value"],Kt={class:"flex-shrink-0 px-4 sm:px-6 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700"},Yt={class:"flex justify-end space-x-3"},Zt=["disabled"],Gt={key:0},Qt={key:1},Jt={__name:"TransferForm",emits:["close","transfer-created"],setup($,{emit:T}){const i=T,A=_e(),{user:_,isSuperAdmin:o}=me(),y=w(!1),g=w([]),b=w({from_account_id:"",from_amount:"",to_account_id:"",to_amount:"",description:""}),h=D(()=>g.value.find(m=>m.id===b.value.from_account_id)),C=D(()=>g.value.find(m=>m.id===b.value.to_account_id)),F=D(()=>!h.value||!C.value?!1:h.value.currency===C.value.currency),x=D(()=>g.value.filter(m=>m.id!==b.value.from_account_id));Q(F,m=>{m&&(b.value.to_amount=b.value.from_amount)}),Q(()=>b.value.from_amount,m=>{F.value&&(b.value.to_amount=m)});const r=async()=>{try{const m=o.value?"/allBankAccount/get":"/bankAccount/get",t=await P.get(`https://api.mgoods.uz/api${m}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}});t.data.status&&(g.value=t.data.data)}catch(m){console.error("Error fetching bank accounts:",m),A.error("Bank hisoblarini yuklashda xatolik yuz berdi")}},a=async()=>{var m,t;if(b.value.from_account_id===b.value.to_account_id){A.error("Bir xil hisobga o'tkazma qilib bo'lmaydi");return}y.value=!0;try{const u=await P.post("https://api.mgoods.uz/api/transfers/transfer/create",b.value,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}});u.data.status&&(A.success("O'tkazma muvaffaqiyatli yaratildi"),i("transfer-created",u.data),i("close"))}catch(u){console.error("Error creating transfer:",u),A.error(((t=(m=u.response)==null?void 0:m.data)==null?void 0:t.message)||"O'tkazma yaratishda xatolik yuz berdi")}finally{y.value=!1}},s=m=>new Intl.NumberFormat("uz-UZ").format(m),n=m=>m?m.toString().replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," "):"",k=m=>{const t=m.target.value.replace(/\D/g,"");b.value.from_amount=t},R=m=>{const t=m.target.value.replace(/\D/g,"");b.value.to_amount=t};return r(),(m,t)=>(l(),d("div",null,[e("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t[0]||(t[0]=u=>m.$emit("close"))}),e("div",zt,[e("div",Dt,[t[7]||(t[7]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"O'tkazma yaratish",-1)),e("button",{onClick:t[1]||(t[1]=u=>m.$emit("close")),class:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},t[6]||(t[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("form",{onSubmit:Y(a,["prevent"]),class:"flex-1 overflow-y-auto"},[e("div",Mt,[e("div",Nt,[e("div",St,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Hisobdan",-1)),S(e("select",{"onUpdate:modelValue":t[2]||(t[2]=u=>b.value.from_account_id=u),required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},[t[8]||(t[8]=e("option",{value:""},"Tanlang...",-1)),(l(!0),d(M,null,j(g.value,u=>(l(),d("option",{key:u.id,value:u.id},f(u.bank_name)+" ("+f(u.currency)+") - "+f(s(u.balance)),9,Ot))),128))],512),[[W,b.value.from_account_id]])]),e("div",Pt,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Hisobga",-1)),S(e("select",{"onUpdate:modelValue":t[3]||(t[3]=u=>b.value.to_account_id=u),required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},[t[10]||(t[10]=e("option",{value:""},"Tanlang...",-1)),(l(!0),d(M,null,j(x.value,u=>(l(),d("option",{key:u.id,value:u.id},f(u.bank_name)+" ("+f(u.currency)+") - "+f(s(u.balance)),9,jt))),128))],512),[[W,b.value.to_account_id]])])]),h.value&&C.value?(l(),d(M,{key:0},[F.value?(l(),d("div",Bt,[e("label",Ut," Summa ("+f(h.value.currency)+") ",1),e("input",{type:"text",value:n(b.value.from_amount),onInput:k,required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},null,40,qt)])):(l(),d("div",It,[e("div",null,[e("label",Lt," Summa ("+f(h.value.currency)+") ",1),e("input",{type:"text",value:n(b.value.from_amount),onInput:k,required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},null,40,Et)]),e("div",null,[e("label",Rt," Summa ("+f(C.value.currency)+") ",1),e("input",{type:"text",value:n(b.value.to_amount),onInput:R,required:"",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},null,40,Ht)])]))],64)):O("",!0),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Izoh",-1)),S(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=u=>b.value.description=u),rows:"3",class:"block w-full px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm text-sm sm:text-base"},null,512),[[ee,b.value.description]])])]),e("div",Kt,[e("div",Yt,[e("button",{type:"button",onClick:t[5]||(t[5]=u=>m.$emit("close")),class:"inline-flex justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600"}," Bekor qilish "),e("button",{type:"submit",disabled:y.value,class:"inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600"},[y.value?(l(),d("span",Gt,"Saqlanmoqda...")):(l(),d("span",Qt,"Saqlash"))],8,Zt)])])],32)])]))}},Wt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},Xt={class:"flex items-center justify-between mb-2"},ea={class:"text-base font-medium text-gray-900 dark:text-white truncate"},ta={class:"flex items-baseline space-x-1"},aa={class:"text-sm text-gray-500 flex-shrink-0"},ra={__name:"BankAccountsGrid",setup($){const T=w([]),i=o=>{const y=parseFloat(o);return isNaN(y)?"0":new Intl.NumberFormat("uz-UZ").format(y)},A=o=>{const y=parseFloat(o);return isNaN(y)?"text-gray-600":y>0?"text-green-600 dark:text-green-400":y<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"},_=async()=>{try{const o=await P.get(`${q}/bankAccount/get`,{headers:await L()});T.value=Array.isArray(o.data)?o.data:o.data.data||[]}catch(o){console.error("Error fetching bank accounts:",o),T.value=[]}};return X(()=>{_()}),(o,y)=>(l(),d("div",Wt,[(l(!0),d(M,null,j(T.value,g=>(l(),d("div",{key:g.id,class:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 whitespace-nowrap overflow-hidden"},[e("div",Xt,[e("h3",ea,f(g.bank_name),1),e("span",{class:E(["text-xs px-2 py-0.5 rounded-full flex-shrink-0 ml-2",g.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},f(g.status),3)]),e("div",ta,[e("span",{class:E(["text-xl font-bold truncate",A(g.balance)])},f(i(g.balance)),3),e("span",aa,f(g.currency),1)])]))),128))]))}},sa={key:0,class:"space-y-6"},oa={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},na={class:"flex flex-col space-y-6"},la={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},ia={class:"flex items-center space-x-4"},da={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},ua={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},ca={key:0,class:"p-6 text-center text-gray-500"},ga={key:1,class:"p-6 text-center text-red-500"},ma={key:2},pa={key:1,class:"flex items-center justify-center h-[calc(100vh-4rem)]"},va={__name:"FinanceView",setup($){const{user:T,isStorekeeper:i}=me(),A=w([]),_=w([]),o=w({}),y=w({}),g=w({bankAccounts:[],kontragents:[],reasons:[]}),b=w({}),h=w(!0),C=w(null),F=w(1),x=w(20),r=w(!1),a=w(!1),s=w("in"),n=v=>{s.value=v,r.value=!0},k=()=>{r.value=!1},R=v=>{m(F.value,b.value)},m=async(v=1,V={})=>{var B,I,ne,le;try{h.value=!0,C.value=null,F.value=v;const Z=await L(),U=Object.keys(V).length>0?Object.entries(V).reduce((z,[de,K])=>(Array.isArray(K)&&K.length>0?z[de]=K.join(","):K&&(z[de]=K),z),{}):{},ie={page:v,per_page:x.value,...Object.keys(U).length>0?U:{}},pe=U.types==="transfer",fe=U.types==="in"||U.types==="out",ye=U.kontragent_ids||U.reason_ids,be=pe,xe=fe||ye,[H,te]=await Promise.all([be?Promise.resolve({data:[],meta:{total:0}}):P.get(`${q}/transactions/get`,{headers:Z,params:ie}).then(z=>z.data),xe?Promise.resolve({data:[],meta:{total:0},filters:{bankAccounts:[]}}):P.get(`${q}/transfers/get`,{headers:Z,params:ie}).then(z=>z.data)]);A.value=H.data||[],_.value=te.data||[],o.value=H.meta||{},y.value=te.meta||{};const ke=((B=te.filters)==null?void 0:B.bankAccounts)||[],ve=((I=H.filters)==null?void 0:I.bankAccounts)||[],G=new Map;ke.forEach(z=>{G.set(z.id,z)}),ve.forEach(z=>{G.has(z.id)||G.set(z.id,z)}),g.value={...g.value,bankAccounts:Array.from(G.values()),kontragents:((ne=H.filters)==null?void 0:ne.kontragents)||[],reasons:((le=H.filters)==null?void 0:le.reasons)||[]},h.value=!1}catch(Z){console.error("Error fetching finance data:",Z),C.value="Failed to fetch finance data. Please try again.",h.value=!1}},t=v=>{m(v,b.value)},u=v=>{x.value=v,F.value=1,m(1,b.value)},c=v=>{b.value=v,m(1,v)},p=()=>{m(F.value,b.value)};return X(()=>{m(1)}),(v,V)=>re(T)&&re(T).is_cashier?(l(),d("div",sa,[e("div",oa,[e("div",na,[e("div",la,[V[4]||(V[4]=e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Moliya",-1)),e("div",ia,[re(i)?O("",!0):(l(),d("button",{key:0,onClick:V[0]||(V[0]=B=>n("in")),class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"}," Kirim ")),e("button",{onClick:V[1]||(V[1]=B=>n("out")),class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"}," Chiqim "),e("button",{onClick:V[2]||(V[2]=B=>a.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," O'tkazma ")])]),N(ra)])]),e("div",da,[N(Ge,{filters:g.value,onFilter:c},null,8,["filters"])]),e("div",ua,[h.value?(l(),d("div",ca," O'tkazmalar yuklanmoqda... ")):C.value?(l(),d("div",ga,f(C.value),1)):(l(),d("div",ma,[N(bt,{transactions:A.value,transfers:_.value,filters:g.value,"transaction-meta":o.value,"transfer-meta":y.value,"current-page":F.value,"per-page":x.value,onPageChange:t,onPerPageChange:u},null,8,["transactions","transfers","filters","transaction-meta","transfer-meta","current-page","per-page"])]))]),(l(),se(we,{to:"body"},[r.value?(l(),se(Vt,{key:0,show:r.value,type:s.value,filters:g.value,onClose:k,onTransactionCreated:R},null,8,["show","type","filters"])):O("",!0)])),a.value?(l(),se(Jt,{key:0,onClose:V[3]||(V[3]=B=>a.value=!1),onTransferCreated:p})):O("",!0)])):(l(),d("div",pa,V[5]||(V[5]=[e("div",{class:"text-center"},[e("h2",{class:"text-2xl font-semibold text-gray-900 dark:text-white mb-2"},"Ruxsat berilmagan"),e("p",{class:"text-gray-600 dark:text-gray-400"},"Sizga qo'shimcha ma'lumotlar uchun ruxsat berilmagan.")],-1)])))}};export{va as default};
