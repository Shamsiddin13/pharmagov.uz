import{m as Z,p as C,o as i,c,F as V,b as q,n as N,t as m,C as ee,a as e,g as S,q as J,h as H,u as x,i as E,v as Q,e as te,f as P,d as w,w as B,k as L,E as ae,z as re,G as D}from"./index-D3wbM7oO.js";import{_ as O}from"./Button-1RoVZDeX.js";import{u as oe,f as le}from"./useStorageFilterData-CC75njG6.js";import{a as se,f as j}from"./formatters-Do8IhxAy.js";import{_ as ne}from"./Pagination-CtU1Q35g.js";import"./auth-Buz3Qiex.js";function de(s,u=300){let r;return function(...n){clearTimeout(r),r=setTimeout(()=>{s.apply(this,n)},u)}}const ie={class:"flex flex-wrap gap-4"},ue=["onClick"],ce={__name:"StorageActionButtons",setup(s){const u=Z(),{user:r}=ee(),n=C(()=>{var k;return((k=r.value)==null?void 0:k.type)==="superadmin"}),g=C(()=>{var k;return((k=r.value)==null?void 0:k.type)==="storekeeper"}),_=C(()=>{var k;return(k=r.value)==null?void 0:k.is_cashier}),b=[{id:"in",label:"Kirim",color:"green",route:"/storage/in"},{id:"out",label:"Chiqim",color:"red",route:"/storage/out"}],y=[{id:"cash",label:"Naqd kirim",color:"green",route:"/storage/cashin"},{id:"debt",label:"Qarz kirim",color:"blue",route:"/storage/debtin"}],p=[{id:"in",label:"Kirim",color:"green",route:"/storage/in"},{id:"out",label:"Chiqim",color:"red",route:"/storage/out"},{id:"cash",label:"Naqd kirim",color:"green",route:"/storage/cashin"},{id:"debt",label:"Qarz kirim",color:"blue",route:"/storage/debtin"},{id:"return",label:"Qaytarish",color:"red",route:"/storage/debtout"}],o=[{id:"enter",label:"Enter",color:"indigo",route:"/storage/enter"},{id:"loss",label:"Loss",color:"orange",route:"/storage/loss"}],f=C(()=>n.value?[...p,...o]:g.value?_.value?y:b:p),A=k=>{k.route?u.push(k.route):console.log("Action clicked:",k.id)};return(k,a)=>(i(),c("div",ie,[(i(!0),c(V,null,q(f.value,h=>(i(),c("button",{key:h.id,onClick:T=>A(h),class:N(["px-4 py-2 text-white rounded-lg transition-colors whitespace-nowrap",{"bg-green-600 hover:bg-green-700":h.color==="green","bg-blue-600 hover:bg-blue-700":h.color==="blue","bg-red-600 hover:bg-red-700":h.color==="red","bg-indigo-600 hover:bg-indigo-700":h.color==="indigo","bg-orange-600 hover:bg-orange-700":h.color==="orange"}])},m(h.label),11,ue))),128))]))}},ge={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},pe=["value"],me=["value"],z={__name:"SelectFilter",props:{label:{type:String,required:!0},options:{type:Array,required:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(s,{emit:u}){const r=u,n=g=>{r("update:modelValue",g.target.value)};return(g,_)=>(i(),c("div",null,[e("label",ge,m(s.label),1),e("select",{value:s.modelValue,onChange:n,class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},[(i(!0),c(V,null,q(s.options,b=>(i(),c("option",{key:b.value,value:b.value},m(b.label),9,me))),128))],40,pe)]))}},_e={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},ye={class:"grid grid-cols-2 gap-4"},ve=["value"],be=["value"],R={__name:"DateFilter",props:{label:{type:String,required:!0},fromDate:{type:String,default:""},toDate:{type:String,default:""}},emits:["update:fromDate","update:toDate"],setup(s,{emit:u}){const r=u,n=_=>{r("update:fromDate",_.target.value)},g=_=>{r("update:toDate",_.target.value)};return(_,b)=>(i(),c("div",null,[e("label",_e,m(s.label),1),e("div",ye,[e("div",null,[b[0]||(b[0]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"From",-1)),e("input",{type:"date",value:s.fromDate,onInput:n,class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,ve)]),e("div",null,[b[1]||(b[1]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"To",-1)),e("input",{type:"date",value:s.toDate,onInput:g,class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,be)])])]))}},xe={class:"flex flex-col items-start"},ke={class:"block text-sm text-gray-700 dark:text-gray-300 mb-1"},fe=["checked"],Y={__name:"CheckboxFilter",props:{label:{type:String,required:!0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:u}){const r=u,n=g=>{r("update:modelValue",g.target.checked)};return(g,_)=>(i(),c("div",xe,[e("label",ke,m(s.label),1),e("input",{type:"checkbox",checked:s.modelValue,onChange:n,class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,40,fe)]))}},he={key:0,class:"p-4 text-center"},we={key:1,class:"p-4 text-red-600 dark:text-red-400"},$e={key:2,class:"space-y-6"},Se={class:"space-y-4"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fe={class:"flex flex-wrap items-center gap-x-6 gap-y-2"},qe={class:"flex flex-wrap items-center gap-x-4"},Ae={class:"text-sm text-gray-700 dark:text-gray-300 mb-1"},Te=["value","checked","onClick"],Ie={class:"flex flex-wrap items-center gap-x-4"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pe={class:"flex justify-end space-x-4"},Ne={__name:"StorageFilter",emits:["filter"],setup(s,{emit:u}){const r=u,{users:n,stores:g,kontragents:_,types:b,loading:y,error:p}=oe(),o=S(null),f=C(()=>{var d;return((d=o.value)==null?void 0:d.type)==="superadmin"});J(async()=>{try{const d=await ae();o.value=d}catch(d){console.error("Error loading user data:",d)}});const k={product_name:"",sku:"",user_id:"",store_id:"",kontragent_id:"",type:"",k_debt_id:void 0,k_transaction_id:void 0,created_at_from:"",created_at_to:"",updated_at_from:"",updated_at_to:""},a=S({...k});H(()=>o.value,d=>{!f.value&&(d!=null&&d.id)&&(a.value.user_id=d.id.toString(),r("filter",{...a.value}))},{immediate:!0});const h=(d,t)=>{a.value[d]=t},T=d=>{a.value.type=a.value.type===d?"":d},I=(d,t)=>{a.value[d]=t?"not_null":void 0},M=()=>{var t;const d={product_name:a.value.product_name||void 0,sku:a.value.sku||void 0,user_id:a.value.user_id||void 0,store_id:a.value.store_id||void 0,kontragent_id:a.value.kontragent_id||void 0,type:a.value.type||void 0,k_debt_id:a.value.k_debt_id,k_transaction_id:a.value.k_transaction_id,created_at_from:a.value.created_at_from||void 0,created_at_to:a.value.created_at_to||void 0,updated_at_from:a.value.updated_at_from||void 0,updated_at_to:a.value.updated_at_to||void 0};Object.keys(d).forEach(l=>d[l]===void 0&&delete d[l]),!f.value&&((t=o.value)!=null&&t.id)&&(d.user_id=o.value.id.toString()),r("filter",d)},v=()=>{var d,t;a.value={...k},!f.value&&((d=o.value)!=null&&d.id)&&(a.value.user_id=o.value.id.toString()),r("filter",!f.value&&((t=o.value)!=null&&t.id)?{user_id:o.value.id}:{})},$=C(()=>f.value);return(d,t)=>x(y)?(i(),c("div",he,t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"},null,-1)]))):x(p)?(i(),c("div",we,m(x(p)),1)):(i(),c("div",$e,[e("div",Se,[e("div",Ce,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Mahsulot nomi",-1)),E(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>a.value.product_name=l),placeholder:"Mahsulot nomi...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,512),[[Q,a.value.product_name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"SKU",-1)),E(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>a.value.sku=l),placeholder:"Mahsulotning SKU...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,512),[[Q,a.value.sku]])])]),e("div",De,[$.value?(i(),te(z,{key:0,label:"User",options:x(n),modelValue:a.value.user_id,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.user_id=l)},null,8,["options","modelValue"])):P("",!0),w(z,{label:"Store",options:x(g),modelValue:a.value.store_id,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.store_id=l)},null,8,["options","modelValue"])]),e("div",Ve,[w(z,{label:"Kontragent",options:x(_),modelValue:a.value.kontragent_id,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.kontragent_id=l)},null,8,["options","modelValue"]),e("div",Fe,[e("div",qe,[(i(!0),c(V,null,q(x(b),l=>(i(),c("label",{key:l.value,class:"inline-flex flex-col items-start"},[e("span",Ae,m(l.label),1),e("input",{type:"radio",value:l.value,checked:a.value.type===l.value,onClick:F=>T(l.value),class:"form-radio h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,8,Te)]))),128))]),t[16]||(t[16]=e("div",{class:"h-6 w-px bg-gray-300 dark:bg-gray-600 hidden sm:block"},null,-1)),e("div",Ie,[w(Y,{label:"Qarz",modelValue:a.value.k_debt_id,"onUpdate:modelValue":[t[5]||(t[5]=l=>a.value.k_debt_id=l),t[6]||(t[6]=l=>I("k_debt_id",l))]},null,8,["modelValue"]),w(Y,{label:"Naqd",modelValue:a.value.k_transaction_id,"onUpdate:modelValue":[t[7]||(t[7]=l=>a.value.k_transaction_id=l),t[8]||(t[8]=l=>I("k_transaction_id",l))]},null,8,["modelValue"])])])]),e("div",Ue,[w(R,{label:"Yaratilgan sana boyicha","from-date":a.value.created_at_from,"to-date":a.value.created_at_to,"onUpdate:fromDate":t[9]||(t[9]=l=>h("created_at_from",l)),"onUpdate:toDate":t[10]||(t[10]=l=>h("created_at_to",l))},null,8,["from-date","to-date"]),w(R,{label:"Oxirgi o'zgartirilgan sana boyicha","from-date":a.value.updated_at_from,"to-date":a.value.updated_at_to,"onUpdate:fromDate":t[11]||(t[11]=l=>h("updated_at_from",l)),"onUpdate:toDate":t[12]||(t[12]=l=>h("updated_at_to",l))},null,8,["from-date","to-date"])])]),e("div",Pe,[w(O,{variant:"secondary",onClick:v},{default:B(()=>t[17]||(t[17]=[L("Filterni tozalash")])),_:1}),w(O,{onClick:M},{default:B(()=>t[18]||(t[18]=[L("Filterni qo'shish")])),_:1})])]))}},Me={class:"space-y-2"},ze={class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},Ke={class:"space-y-2"},Ee={__name:"StorageItemsList",props:{items:{type:Array,required:!0}},setup(s){return(u,r)=>(i(),c("div",Me,[r[1]||(r[1]=e("h4",{class:"font-medium text-gray-700 dark:text-gray-300"},"Mahsulotlar",-1)),e("div",ze,[r[0]||(r[0]=e("div",{class:"grid grid-cols-5 gap-5 mb-2 text-sm font-medium text-gray-500 dark:text-gray-400"},[e("div",null,"Mahsulot"),e("div",null,"SKU"),e("div",null,"Miqdori"),e("div",null,"Narxi"),e("div",null,"Jami narxi")],-1)),e("div",Ke,[(i(!0),c(V,null,q(s.items,n=>(i(),c("div",{key:n.id,class:"grid grid-cols-5 gap-5 text-sm text-gray-900 dark:text-gray-100"},[e("div",null,m(n.product_name),1),e("div",null,m(n.sku),1),e("div",null,m(x(se)(n.quantity)),1),e("div",null,m(x(j)(n.real_buy_price)),1),e("div",null,m(x(j)(n.real_buy_price*n.quantity)),1)]))),128))])])]))}},G={income:{label:"Kirim",colorClass:"text-green-600 dark:text-green-400"},outcome:{label:"Chiqim",colorClass:"text-red-600 dark:text-red-400"},enter:{label:"Enter",colorClass:"text-indigo-600 dark:text-indigo-400"},loss:{label:"Loss",colorClass:"text-orange-600 dark:text-orange-400"}},Qe={__name:"StorageTypeLabel",props:{type:{type:String,required:!0,validator:s=>["income","outcome","enter","loss"].includes(s)}},setup(s){return(u,r)=>{var n,g;return i(),c("span",{class:N(["px-2 py-1 text-sm font-medium rounded-md",(n=x(G)[s.type])==null?void 0:n.colorClass])},m((g=x(G)[s.type])==null?void 0:g.label),3)}}},Be={__name:"PaymentTypeTag",props:{kDebtId:{type:[String,Number,null],default:null},kTransactionId:{type:[String,Number,null],default:null},type:{type:String,required:!0}},setup(s){const u=s,r=C(()=>{if(u.kDebtId)return"Qarz";if(u.kTransactionId)return"Naq";if(!u.kDebtId&&!u.kTransactionId){if(u.type==="outcome")return"Qaytarildi";if(u.type==="income")return"Do'kon"}return null}),n=C(()=>{switch(r.value){case"Qarz":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"Naq":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"Qaytarildi":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"Do'kon":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";default:return""}});return(g,_)=>r.value?(i(),c("span",{key:0,class:N(["ml-2 px-2 py-0.5 text-xs font-medium rounded-full",n.value])},m(r.value),3)):P("",!0)}},Le={class:"overflow-x-auto"},Oe={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},je={class:"bg-gray-50 dark:bg-gray-800"},Re={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},Ye={key:0},Ge=["colspan"],Je=["onClick"],He=["onClick"],We={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},Xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},Ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},et={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},at={class:"px-6 py-4 whitespace-nowrap"},rt={class:"flex items-center"},ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},lt={class:"px-6 py-4 text-sm text-gray-900 dark:text-white"},st={class:"px-6 py-4 text-sm text-gray-900 dark:text-white"},nt={key:0,class:"bg-gray-50 dark:bg-gray-700"},dt=["colspan"],it={class:"text-sm text-gray-900 dark:text-white"},ut={__name:"StorageTable",props:{items:{type:Array,required:!0}},setup(s){const u=s,r=S(new Set),n=[{key:"id",label:"ID"},{key:"created_at",label:"Yaratilgan sana"},{key:"user_name",label:"Foydalanuvchi"},{key:"store_name",label:"Do'kon"},{key:"kontragent_name",label:"Kontragent"},{key:"type",label:"Type"},{key:"k_amount",label:"Summa"},{key:"description",label:"Izoh"},{key:"updated_at",label:"O'zgartirilgan sana"}],g=C(()=>new Map(u.items.map(y=>[y.id,r.value.has(y.id)]))),_=y=>{const p=new Set(r.value);p.has(y)?p.delete(y):p.add(y),r.value=p};H(()=>u.items.length,()=>{r.value=new Set});const b=y=>Number(y).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,".");return(y,p)=>(i(),c("div",Le,[e("table",Oe,[e("thead",je,[e("tr",null,[p[1]||(p[1]=e("th",{class:"w-10 px-6 py-3"},null,-1)),(i(),c(V,null,q(n,o=>e("th",{key:o.key,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"},m(o.label),1)),64))])]),e("tbody",Re,[s.items.length===0?(i(),c("tr",Ye,[e("td",{colspan:n.length+1,class:"px-6 py-4 text-center text-gray-500 dark:text-gray-400"}," Ma'lumotlar topilmadi ",8,Ge)])):P("",!0),(i(!0),c(V,null,q(s.items,o=>(i(),c(V,{key:o.id},[e("tr",{class:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:f=>_(o.id)},[e("td",{class:"px-6 py-4 w-10",onClick:p[0]||(p[0]=re(()=>{},["stop"]))},[e("button",{onClick:f=>_(o.id),class:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-full transition-colors"},[(i(),c("svg",{class:N(["w-4 h-4 transition-transform duration-200",{"rotate-90":g.value.get(o.id)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},p[2]||(p[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)]),2))],8,He)]),e("td",We,m(o.id),1),e("td",Xe,m(o.created_at),1),e("td",Ze,m(o.user_name),1),e("td",et,m(o.store_name),1),e("td",tt,m(o.kontragent_name),1),e("td",at,[e("div",rt,[w(Qe,{type:o.type},null,8,["type"]),w(Be,{"k-debt-id":o.k_debt_id,"k-transaction-id":o.k_transaction_id,type:o.type},null,8,["k-debt-id","k-transaction-id","type"])])]),e("td",ot,m(b(o.k_amount)),1),e("td",lt,m(o.description),1),e("td",st,m(o.updated_at),1)],8,Je),g.value.get(o.id)?(i(),c("tr",nt,[e("td",{colspan:n.length+1,class:"px-6 py-4"},[e("div",it,[w(Ee,{items:o.items||[]},null,8,["items"])])],8,dt)])):P("",!0)],64))),128))])])]))}};function ct(){const s=S([]),u=S({}),r=S(!0),n=S(null),g=S(1),_=S(20),b=S({}),y=S(new Map),p=S(new Map),o=5*60*1e3,f=C(()=>s.value.map(v=>({...v,formattedDate:new Date(v.created_at).toLocaleString(),formattedPrice:new Intl.NumberFormat("en-US").format(v.price)}))),A=v=>{const $=p.value.get(v);return $&&Date.now()-$<o},k=()=>{var $;const v=`${g.value}-${_.value}-${JSON.stringify(b.value)}`;return!D.isSuperAdmin&&(($=D.user)!=null&&$.id)?`${v}-user-${D.user.id}`:v};async function a(v={}){var l;const{showLoader:$=!0,forceFetch:d=!1}=v,t=k();if(!d&&A(t)&&y.value.has(t)){s.value=y.value.get(t).items,u.value=y.value.get(t).meta;return}$&&(r.value=!0),n.value=null;try{const F={...b.value};!D.isSuperAdmin&&((l=D.user)!=null&&l.id)&&(F.user_id=D.user.id.toString());const U=await le(g.value,{...F,per_page:_.value});y.value.set(t,{items:U.data,meta:U.meta}),p.value.set(t,Date.now());const W=Date.now();for(const[K,X]of p.value.entries())W-X>o&&(y.value.delete(K),p.value.delete(K));s.value=U.data,u.value=U.meta}catch(F){console.error("Error loading storage items:",F),n.value=F.message,s.value=[]}finally{r.value=!1}}const h=de(()=>a({preserveScroll:!0}),500);function T(v){var $;!D.isSuperAdmin&&(($=D.user)!=null&&$.id)&&(v.user_id=D.user.id.toString()),b.value=v,g.value=1,h()}function I(v){v!==g.value&&(g.value=v,a({preserveScroll:!0}))}function M(v){v!==_.value&&(_.value=v,g.value=1,a({preserveScroll:!0}))}return{items:s,meta:u,loading:r,error:n,visibleItems:f,handleFilter:T,handlePageChange:I,handlePerPageChange:M,loadItems:a}}const gt={class:"space-y-6"},pt={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},mt={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},_t={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},yt={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},vt={key:0,class:"text-center py-8"},bt={key:1,class:"p-6 text-red-600 dark:text-red-400"},St={__name:"StorageView",setup(s){const{items:u,meta:r,loading:n,error:g,handleFilter:_,handlePageChange:b,handlePerPageChange:y,loadItems:p}=ct();return J(p),(o,f)=>(i(),c("div",gt,[e("div",pt,[e("div",mt,[f[0]||(f[0]=e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Ombor kirdi / chiqdi malumotlari",-1)),w(ce)])]),e("div",_t,[w(Ne,{onFilter:x(_)},null,8,["onFilter"])]),e("div",yt,[x(n)?(i(),c("div",vt,f[1]||(f[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"},null,-1)]))):x(g)?(i(),c("div",bt,m(x(g)),1)):(i(),c(V,{key:2},[w(ut,{items:x(u)},null,8,["items"]),w(ne,{meta:x(r),onPageChange:x(b),onPerPageChange:x(y)},null,8,["meta","onPageChange","onPerPageChange"])],64))])]))}};export{St as default};
