import{g as c,h as H,q as Q,c as f,a as e,d as x,w as R,z as L,i as u,j as Z,F as J,b as O,t as b,v as g,n as P,I as C,H as X,o as h,k as G,f as W,m as Y,B as tt}from"./index-D3wbM7oO.js";import{_ as U}from"./SearchSelect-tzwJ1XQW.js";import{f as m,p as et,u as at}from"./numberFormat-CYHKIeaX.js";import{A as rt}from"./api-JDA1JVME.js";import{g as ot}from"./auth-Buz3Qiex.js";const lt={class:"space-y-6"},st={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},dt={class:"flex justify-between items-center"},it={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ut={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ct={class:"space-y-4"},gt={class:"flex justify-between items-start"},mt={class:"text-md font-medium text-gray-900 dark:text-white"},pt=["onClick"],bt={class:"grid grid-cols-12 gap-4"},yt={class:"col-span-9"},_t={class:"col-span-3"},vt=["onUpdate:modelValue"],kt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ft={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},xt=["onUpdate:modelValue","onInput"],ht=["onUpdate:modelValue","onInput"],wt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},Vt=["onUpdate:modelValue","onInput"],St={class:"space-y-4 pt-6 border-t border-gray-200 dark:border-gray-700"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},It={class:"flex gap-4 items-end"},Mt={class:"flex-1"},Pt={class:"flex gap-2"},Ct={class:"flex justify-end"},Dt=["disabled"],$t={__name:"DebtInStorageView",setup(Tt){const D=Y(),q=c(!1),p=c([]),w=c(null),V=c(null),a=c({store_id:"",kontragent_id:"",k_debt_currency:"",k_amount:0,formatted_k_amount:"0",description:"",items:[]}),I=()=>{a.value.items.push({product_id:"",variant_id:null,product_name:"",sku:"",article:"",real_buy_price:0,original_buy_price:0,formatted_buy_price:"0",quantity:1,sub_total:0,formatted_sub_total:"0"}),C(()=>{p.value.push(null)})},T=r=>{a.value.items.splice(r,1),p.value.splice(r,1),_()},N=r=>{w.value=r,a.value.store_id=r.id,V.value=null,a.value.kontragent_id=""},j=r=>{V.value=r,a.value.kontragent_id=r.id},B=(r,t)=>{const o=et(r.target.value);a.value.items[t].real_buy_price=o,a.value.items[t].original_buy_price=o,a.value.items[t].formatted_buy_price=m(o),y(t)},F=r=>{y(r)},A=(r,t)=>{const o=r.target.value;if(a.value.items[t].formatted_sub_total=o,a.value.items[t].sub_total=at(o),a.value.items[t].quantity>0){const i=a.value.items[t].sub_total/a.value.items[t].quantity;a.value.items[t].real_buy_price=i,a.value.items[t].formatted_buy_price=m(i)}_()},y=r=>{const t=a.value.items[r],o=t.real_buy_price*t.quantity;t.sub_total=o,t.formatted_sub_total=m(o),_()},_=()=>{const r=a.value.items.reduce((t,o)=>t+o.sub_total,0);a.value.k_amount=r,a.value.formatted_k_amount=m(r)};H(()=>a.value.k_amount,r=>{a.value.formatted_k_amount=m(r)});const $=async(r,t)=>{const o=a.value.items[t],i=r.base_product_id||r.id,d=r.type==="variant"?r.id:null;if(a.value.items.some((l,n)=>n!==t&&l.product_id===i&&l.variant_id===d)){alert("Bu mahsulot qo'shilgan"),a.value.items[t]={...a.value.items[t],product_id:"",variant_id:null,product_name:"",sku:"",article:"",real_buy_price:0,original_buy_price:0,formatted_buy_price:"0",quantity:1,sub_total:0,formatted_sub_total:"0"},C(()=>{p.value[t]&&p.value[t].reset()});return}o.product_id=i,o.variant_id=d,o.product_name=r.name,o.sku=r.sku,o.article=r.article,o.real_buy_price=Math.round(r.buy_price||0),o.original_buy_price=Math.round(r.buy_price||0),o.formatted_buy_price=m(o.real_buy_price),o.quantity=1,y(t)},z=()=>{if(!a.value.store_id)return alert("Please select a store"),!1;if(!a.value.kontragent_id)return alert("Please select a kontragent"),!1;if(!a.value.k_debt_currency)return alert("Please select a currency"),!1;if(!a.value.items.length)return alert("Please add at least one item"),!1;for(const r of a.value.items)if(!r.product_id||!r.quantity||!r.real_buy_price)return alert("Please fill in all item details"),!1;return!0},K=async()=>{var r,t;if(z())try{const o=await ot();(await tt.post(`${rt}/storages/debt/in`,{store_id:parseInt(a.value.store_id),kontragent_id:parseInt(a.value.kontragent_id),k_debt_currency:a.value.k_debt_currency,k_amount:a.value.k_amount,description:a.value.description,items:a.value.items.map(d=>({product_id:parseInt(d.product_id),variant_id:d.variant_id,sku:d.sku,article:d.article,real_buy_price:d.real_buy_price,quantity:d.quantity,sub_total:d.sub_total}))},{headers:o})).data.status&&D.push("/storage")}catch(o){console.error("Error submitting form:",o),alert(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.message)||"An error occurred")}},v=c(0),k=c("plus"),M=r=>{k.value=r},E=()=>{if(!v.value)return;const r=parseFloat(v.value)/100;a.value.items.forEach((t,o)=>{let i=t.original_buy_price,d=i*r;k.value==="minus"?t.real_buy_price=i-d:t.real_buy_price=i+d,t.formatted_buy_price=m(t.real_buy_price),y(o)}),_()};return Q(()=>{I()}),(r,t)=>{var i,d,S;const o=X("router-link");return h(),f("div",lt,[e("div",st,[e("div",dt,[t[9]||(t[9]=e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Qarz kirim",-1)),x(o,{to:"/storage",class:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},{default:R(()=>t[8]||(t[8]=[G(" Omborga qaytish ")])),_:1})])]),e("div",it,[e("form",{onSubmit:L(K,["prevent"]),class:"space-y-6"},[e("div",nt,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Do'kon",-1)),x(U,{modelValue:a.value.store_id,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.store_id=l),"display-value":((i=w.value)==null?void 0:i.name)||"",placeholder:"Search store...","search-endpoint":"/search/stores","additional-params":{group_id:47},onSelect:N},null,8,["modelValue","display-value"])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Kontragent",-1)),x(U,{modelValue:a.value.kontragent_id,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.kontragent_id=l),"display-value":((d=V.value)==null?void 0:d.name)||"",placeholder:"Search kontragent...","search-endpoint":"/search/kontragents","additional-params":{store_id:a.value.store_id},onSelect:j,disabled:((S=w.value)==null?void 0:S.group_id)===48},null,8,["modelValue","display-value","additional-params","disabled"])])]),e("div",ut,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Valyuta",-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.k_debt_currency=l),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},t[12]||(t[12]=[e("option",{value:""},"Valyutani tanlash",-1),e("option",{value:"UZS"},"UZS",-1),e("option",{value:"USD"},"USD",-1)]),512),[[Z,a.value.k_debt_currency]])])]),e("div",ct,[e("div",{class:"flex justify-between items-center"},[t[14]||(t[14]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Mahsulotlar",-1)),e("button",{type:"button",onClick:I,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Mahsulot qo'shish ")]),(h(!0),f(J,null,O(a.value.items,(l,n)=>(h(),f("div",{key:n,class:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg space-y-4"},[e("div",gt,[e("h3",mt,"Mahsulot "+b(n+1),1),a.value.items.length>1?(h(),f("button",{key:0,type:"button",onClick:s=>T(n),class:"text-red-600 hover:text-red-700"}," Mahsulotni o'chirish ",8,pt)):W("",!0)]),e("div",bt,[e("div",yt,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Mahsulot",-1)),x(U,{ref_for:!0,ref:s=>{s&&(p.value[n]=s)},"model-value":l.product_id,"display-value":l.product_name,"search-endpoint":"/search/products","additional-params":{store_id:a.value.store_id},placeholder:"Mahsulotni tanlash",disabled:!a.value.store_id,onSelect:s=>$(s,n)},null,8,["model-value","display-value","additional-params","disabled","onSelect"])]),e("div",_t,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"SKU",-1)),u(e("input",{type:"text","onUpdate:modelValue":s=>l.sku=s,class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2",readonly:""},null,8,vt),[[g,l.sku]])])]),e("div",kt,[e("div",null,[e("label",ft,"Xarid narxi ("+b(a.value.k_debt_currency)+")",1),u(e("input",{type:"text","onUpdate:modelValue":s=>l.formatted_buy_price=s,onInput:s=>B(s,n),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,xt),[[g,l.formatted_buy_price]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Miqdor",-1)),u(e("input",{type:"number","onUpdate:modelValue":s=>l.quantity=s,min:"1",onInput:()=>F(n),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,ht),[[g,l.quantity]])]),e("div",null,[e("label",wt,"Jami summa ("+b(a.value.k_debt_currency)+")",1),u(e("input",{type:"text","onUpdate:modelValue":s=>l.formatted_sub_total=s,onInput:s=>A(s,n),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,Vt),[[g,l.formatted_sub_total]])])])]))),128))]),e("div",St,[e("div",Ut,[e("div",null,[e("label",qt,"Umumiy summa ("+b(a.value.k_debt_currency)+")",1),u(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=l=>a.value.formatted_k_amount=l),readonly:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-white px-4 py-2"},null,512),[[g,a.value.formatted_k_amount]])]),e("div",It,[e("div",Mt,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Foiz",-1)),u(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=l=>v.value=l),step:"0.1",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2",placeholder:"0.5"},null,512),[[g,v.value]])]),e("div",Pt,[e("button",{type:"button",class:P(["px-4 py-2 rounded-lg transition-colors",k.value==="plus"?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200"]),onClick:t[5]||(t[5]=l=>M("plus"))}," + ",2),e("button",{type:"button",class:P(["px-4 py-2 rounded-lg transition-colors",k.value==="minus"?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200"]),onClick:t[6]||(t[6]=l=>M("minus"))}," - ",2)]),e("button",{type:"button",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",onClick:E}," Hisoblash ")])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Qo'shimcha ma'lumot",-1)),u(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.description=l),rows:"3",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,512),[[g,a.value.description]])]),e("div",Ct,[e("button",{type:"submit",class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",disabled:q.value},b(q.value?"Saqlanmoqda...":"Saqlash"),9,Dt)])])],32)])])}}};export{$t as default};
