import{g as c,h as Y,q as tt,c as y,a as e,d as V,w as et,z as at,i as g,j as rt,F as T,b as F,t as b,v as m,n as N,I as D,B as j,H as ot,o as _,k as lt,f as st,m as nt}from"./index-D3wbM7oO.js";import{_ as U}from"./ApiSearchSelect-CmtQZZ6U.js";import{A as $}from"./api-JDA1JVME.js";import{g as z}from"./auth-Buz3Qiex.js";import"./SearchSelect-tzwJ1XQW.js";const it={class:"space-y-6"},dt={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},ut={class:"flex justify-between items-center"},ct={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6"},gt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},bt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},mt=["value"],pt={class:"space-y-4"},yt={class:"flex justify-between items-start"},_t={class:"text-md font-medium text-gray-900 dark:text-white"},vt=["onClick"],kt={class:"grid grid-cols-12 gap-4"},ft={class:"col-span-9"},ht={class:"col-span-3"},xt=["onUpdate:modelValue"],wt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Vt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},St=["onUpdate:modelValue","onInput"],qt=["onUpdate:modelValue","onInput"],It={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},Ut=["onUpdate:modelValue","onInput"],Ct={class:"space-y-4 pt-6 border-t border-gray-200 dark:border-gray-700"},Mt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},At={class:"flex gap-4 items-end"},Bt={class:"flex-1"},Tt={class:"flex gap-2"},Ft={class:"flex justify-end"},Nt=["disabled"],Kt={__name:"CashInStorageView",setup(Dt){const E=nt(),C=c(!1),S=c(null),q=c(null),k=c([]),p=c(""),v=c([]),a=c({store_id:"",kontragent_id:"",bank_account_id:"",k_amount:0,formatted_k_amount:"0",description:"",items:[]}),f=c(0),h=c("plus"),M=()=>{a.value.items.push({product_id:"",variant_id:null,product_name:"",sku:"",article:"",real_buy_price:0,original_buy_price:0,formatted_buy_price:"0",quantity:1,sub_total:0,formatted_sub_total:"0"}),D(()=>{v.value.push(null)})},H=r=>{a.value.items.splice(r,1),v.value.splice(r,1),w()},K=r=>{S.value=r,a.value.store_id=r.id,q.value=null,a.value.kontragent_id="",a.value.bank_account_id="",P()},R=r=>{q.value=r,a.value.kontragent_id=r.id},L=r=>{const t=r.target.value,o=k.value.find(i=>i.id===parseInt(t));o&&(p.value=o.currency)},Q=(r,t)=>{const o=B(r.target.value);a.value.items[t].real_buy_price=o,a.value.items[t].original_buy_price=o,a.value.items[t].formatted_buy_price=u(o),x(t)},J=r=>{x(r)},O=(r,t)=>{const o=B(r.target.value);if(a.value.items[t].sub_total=o,a.value.items[t].formatted_sub_total=u(o),a.value.items[t].quantity>0){const i=a.value.items[t].sub_total/a.value.items[t].quantity;a.value.items[t].real_buy_price=i,a.value.items[t].formatted_buy_price=u(i)}w()},x=r=>{const t=a.value.items[r],o=t.real_buy_price*t.quantity;t.sub_total=o,t.formatted_sub_total=u(o),w()},w=()=>{const r=a.value.items.reduce((t,o)=>t+o.sub_total,0);a.value.k_amount=r,a.value.formatted_k_amount=u(r)};Y(()=>a.value.k_amount,r=>{a.value.formatted_k_amount=u(r)});const P=async()=>{try{const r=await z(),t=await j.get(`${$}/bankAccount/get`,{headers:r});t.data.status&&(k.value=t.data.data)}catch(r){console.error("Error loading bank accounts:",r),k.value=[]}},X=async(r,t)=>{const o=a.value.items[t],i=r.base_product_id||r.id,n=r.type==="variant"?r.id:null;if(a.value.items.some((l,d)=>d!==t&&l.product_id===i&&l.variant_id===n)){alert("Bu mahsulot qo'shilgan"),a.value.items[t]={...a.value.items[t],product_id:"",variant_id:null,product_name:"",sku:"",article:"",real_buy_price:0,original_buy_price:0,formatted_buy_price:"0",quantity:1,sub_total:0,formatted_sub_total:"0"},D(()=>{v.value[t]&&v.value[t].reset()});return}o.product_id=i,o.variant_id=n,o.product_name=r.name,o.sku=r.sku,o.article=r.article,o.real_buy_price=Math.round(r.buy_price||0),o.original_buy_price=Math.round(r.buy_price||0),o.formatted_buy_price=u(o.real_buy_price),o.quantity=1,x(t)},A=r=>{h.value=r},Z=()=>{if(!f.value)return;const r=parseFloat(f.value)/100;a.value.items.forEach((t,o)=>{let i=t.original_buy_price,n=i*r;h.value==="minus"?t.real_buy_price=i-n:t.real_buy_price=i+n,t.formatted_buy_price=u(t.real_buy_price),x(o)}),w()},G=()=>{if(!a.value.store_id)return alert("Please select a store"),!1;if(!a.value.kontragent_id)return alert("Please select a kontragent"),!1;if(!a.value.bank_account_id)return alert("Please select a bank account"),!1;if(!p.value)return alert("Currency is required. Please select a bank account"),!1;if(!a.value.items.length)return alert("Please add at least one item"),!1;for(const r of a.value.items)if(!r.product_id||!r.quantity||!r.real_buy_price)return alert("Please fill in all item details"),!1;return!0},W=async()=>{var r,t;if(G())try{const o=await z();(await j.post(`${$}/storages/cash/in`,{store_id:parseInt(a.value.store_id),kontragent_id:parseInt(a.value.kontragent_id),bank_account_id:parseInt(a.value.bank_account_id),k_debt_currency:p.value,k_amount:a.value.k_amount,description:a.value.description,items:a.value.items.map(n=>({product_id:parseInt(n.product_id),variant_id:n.variant_id,sku:n.sku,article:n.article,real_buy_price:n.real_buy_price,quantity:n.quantity,sub_total:n.sub_total}))},{headers:o})).data.status&&E.push("/storage")}catch(o){console.error("Error submitting form:",o),alert(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.message)||"An error occurred")}},u=r=>new Intl.NumberFormat("uz-UZ").format(r),B=r=>parseFloat(r.replace(/\D+/g,""));return tt(()=>{M(),P()}),(r,t)=>{var i,n,I;const o=ot("router-link");return _(),y("div",it,[e("div",dt,[e("div",ut,[t[9]||(t[9]=e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Naqd kirim",-1)),V(o,{to:"/storage",class:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},{default:et(()=>t[8]||(t[8]=[lt(" Omborga qaytish ")])),_:1})])]),e("div",ct,[e("form",{onSubmit:at(W,["prevent"]),class:"space-y-6"},[e("div",gt,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Do'kon",-1)),V(U,{modelValue:a.value.store_id,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.store_id=l),"display-value":((i=S.value)==null?void 0:i.name)||"",placeholder:"Search store...",endpoint:"/search/stores","additional-params":{group_id:47},onSelect:K},null,8,["modelValue","display-value"])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Kontragent",-1)),V(U,{modelValue:a.value.kontragent_id,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.kontragent_id=l),"display-value":((n=q.value)==null?void 0:n.name)||"",placeholder:"Search kontragent...",endpoint:"/search/kontragents","additional-params":{store_id:a.value.store_id},onSelect:R,disabled:((I=S.value)==null?void 0:I.group_id)===48},null,8,["modelValue","display-value","additional-params","disabled"])])]),e("div",bt,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Hisob",-1)),g(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.bank_account_id=l),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500",onChange:L},[t[12]||(t[12]=e("option",{value:""},"Select Bank Account",-1)),(_(!0),y(T,null,F(k.value,l=>(_(),y("option",{key:l.id,value:l.id},b(l.bank_name)+" ("+b(l.currency)+") - "+b(u(l.balance)),9,mt))),128))],544),[[rt,a.value.bank_account_id]])])]),e("div",pt,[e("div",{class:"flex justify-between items-center"},[t[14]||(t[14]=e("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Mahsulotlar",-1)),e("button",{type:"button",onClick:M,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Mahsulot qo'shish ")]),(_(!0),y(T,null,F(a.value.items,(l,d)=>(_(),y("div",{key:d,class:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg space-y-4"},[e("div",yt,[e("h3",_t,"Mahsulot "+b(d+1),1),a.value.items.length>1?(_(),y("button",{key:0,type:"button",onClick:s=>H(d),class:"text-red-600 hover:text-red-700"}," Mahsulotni o'chirish ",8,vt)):st("",!0)]),e("div",kt,[e("div",ft,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Mahsulot",-1)),V(U,{ref_for:!0,ref:s=>{s&&(v.value[d]=s)},"model-value":l.product_id,"display-value":l.product_name,endpoint:"/search/products","additional-params":{store_id:a.value.store_id},placeholder:"Mahsulotni qidirish",disabled:!a.value.store_id,onSelect:s=>X(s,d)},null,8,["model-value","display-value","additional-params","disabled","onSelect"])]),e("div",ht,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"SKU",-1)),g(e("input",{type:"text","onUpdate:modelValue":s=>l.sku=s,class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2",readonly:""},null,8,xt),[[m,l.sku]])])]),e("div",wt,[e("div",null,[e("label",Vt,"Xarid narxi ("+b(p.value)+")",1),g(e("input",{type:"text","onUpdate:modelValue":s=>l.formatted_buy_price=s,onInput:s=>Q(s,d),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,St),[[m,l.formatted_buy_price]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Miqdor",-1)),g(e("input",{type:"number","onUpdate:modelValue":s=>l.quantity=s,min:"1",onInput:()=>J(d),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,qt),[[m,l.quantity]])]),e("div",null,[e("label",It,"Jami summa ("+b(p.value)+")",1),g(e("input",{type:"text","onUpdate:modelValue":s=>l.formatted_sub_total=s,onInput:s=>O(s,d),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,40,Ut),[[m,l.formatted_sub_total]])])])]))),128))]),e("div",Ct,[e("div",Mt,[e("div",null,[e("label",Pt,"Umumiy summa ("+b(p.value)+")",1),g(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=l=>a.value.formatted_k_amount=l),readonly:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-white px-4 py-2"},null,512),[[m,a.value.formatted_k_amount]])]),e("div",At,[e("div",Bt,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Foiz",-1)),g(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=l=>f.value=l),step:"0.1",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2",placeholder:"0.5"},null,512),[[m,f.value]])]),e("div",Tt,[e("button",{type:"button",class:N(["px-4 py-2 rounded-lg transition-colors",h.value==="plus"?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200"]),onClick:t[5]||(t[5]=l=>A("plus"))}," + ",2),e("button",{type:"button",class:N(["px-4 py-2 rounded-lg transition-colors",h.value==="minus"?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200"]),onClick:t[6]||(t[6]=l=>A("minus"))}," - ",2)]),e("button",{type:"button",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",onClick:Z}," Hisoblash ")])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Qo'shimcha ma'lumot",-1)),g(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.description=l),rows:"3",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 focus:ring-2 focus:ring-indigo-500"},null,512),[[m,a.value.description]])]),e("div",Ft,[e("button",{type:"submit",class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",disabled:C.value},b(C.value?"Saqlanmoqda...":"Saqlash"),9,Nt)])])],32)])])}}};export{Kt as default};
